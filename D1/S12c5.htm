<HTML><HEAD><TITLE>Fiddling Around in IOleObject</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD><BODY bgcolor="#FFFFFF">
<font face="verdana,arial,helvetica" size="2"><FORM NAME="x"><OBJECT CLASSID="clsid:9c2ac687-ceef-11cf-96d9-00a0c903b016" NAME="iv"></OBJECT></FORM>
<H3>Fiddling Around in <I>IOleObject</I></H3><P>If your handler is present on a machine without the local server, a container's calls to <I>IOleObject::DoVerb </I>will fail. If your handler simply delegates all of <I>IOleObject </I>to the default handler, nothing else will happen. What you can do, however, is intercept this call and see whether it fails first. In response to failure, you can display a message telling the user what to do to get real server code:</P>
<P><BR></P>
<pre><code>STDMETHODIMP CImpIOleObject::DoVerb(LONG iVerb, LPMSG pMSG<BR>    , LPOLECLIENTSITE pSite, LONG lIndex, HWND hWnd, LPCRECT prc)<BR>    {<BR>    HRESULT     hr;<BR><BR>    hr=m_pObj-&gt;m_pDefIOleObject-&gt;DoVerb(iVerb, pMSG, pSite, lIndex<BR>        , hWnd, prc);<BR><BR>    if (FAILED(hr))<BR>        {<BR>        MessageBox(hWnd, TEXT("Local server not present.\nIf\<BR> I wanted to make money\nI would put some advertising here.")<BR>            , TEXT("Cosmo Handler"), MB_OK);<BR>        }<BR><BR>    return hr;<BR>    }</code></pre>
<P>This is a wonderful way to sneak in some free advertising! But it does require that you override all the rest of the <I>IOleObject </I>member functions—which are many—to do nothing more than delegate to the default handler. If you choose to do this, you should also override the <I>GetExtent </I>member to call your own <I>IViewObject2::GetExtent</I>.</P></font></body></HTML>
