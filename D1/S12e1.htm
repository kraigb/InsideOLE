<HTML><HEAD><TITLE>Implement IPersistFile and Activate the Object</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD><BODY bgcolor="#FFFFFF">
<font face="verdana,arial,helvetica" size="2"><FORM NAME="x"><OBJECT CLASSID="clsid:9c2ac687-ceef-11cf-96d9-00a0c903b016" NAME="iv"></OBJECT></FORM>
<H3>Implement <I>IPersistFil</I><I>e</I> and Activate the Object</H3><P>After you copy link-source data to the clipboard, containers can create a linked object from it.1 After all, it only takes a moniker to create the linked object. If you copy the link-source data now and try to activate the object, your server will be launched, provided <I>GetClassFile </I>can map your file moniker contents to your CLSID. Unfortunately, activation will not succeed because we haven't implemented <I>IPersistFile </I>yet. That is the next step, and the implementation is different from the ones we saw in Chapters 8, 9, and even 14. (In Chapter 14, Cosmo implemented <I>IPersistFile </I>support for accessing a file as an automation object.) Here we implement this interface as part of Cosmo's <I>CFigure </I>class alongside <I>IOleObject </I>and <I>IDataObject.</I> So after we've loaded the file, we'll be queried for <I>IOleObject</I>. When we've returned that interface, we should see a call to <I>IOleObject::DoVerb</I>, in which we activate our user interface.</P>
<P>Because we're editing a linked object, however, we do not—repeat, do not—modify the server's user interface when we show the window (as we did for embeddings in Chapter 18). With linked objects, end users need to know that they are working with a file, so they need File menu commands through which they can save or rename the file. In Chapter 18, we only switched the user interface around from within <I>IOleObject::SetHostNames</I>. Well, that function is never called for a linked object in a local server, so we never have to bother the UI. No problem!</P>
<P></P>

<TABLE COLS="1" BORDER="0" CELLPADDING="7"><COLGROUP><COL WIDTH="432pt" VALIGN="TOP"></COLGROUP><TBODY><TR><TD VALIGN="TOP"><P><B></B></P></TD></TR><TR><TD VALIGN="TOP"><P>1 Including OLE 1 containers, which see your moniker as OLE 1 link-source data.</P></TD></TR></TBODY></TABLE>
<P><BR></P></font></body></HTML>
