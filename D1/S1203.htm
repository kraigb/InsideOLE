<HTML><HEAD><TITLE>Paste</TITLE><META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset= iso-8859-1"><style>@import url(/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/msdn_ie3.css"></HEAD><BODY bgcolor="#FFFFFF">
<font face="verdana,arial,helvetica" size="2"><FORM NAME="x"><OBJECT CLASSID="clsid:9c2ac687-ceef-11cf-96d9-00a0c903b016" NAME="iv"></OBJECT></FORM>
<H3>Paste</H3><P>Paste is essentially the same operation as checking pastability except that instead of calling <I>IDataObject::QueryGetData</I> we call <I>IDataObject::GetData</I> with the following steps:</P>
<P>Obtain a data object pointer by calling <I>OleGetClipboard</I>, which calls <I>AddRef</I> through the pointer before returning.</P>
<P>Call <I>IDataObject::GetData</I> to retrieve whatever data you want.<I> </I>As a consumer, you now own the data, so call <I>ReleaseStgMedium</I> when you finish with it. Also, you must not hold on to this data—copy it as necessary. This is no different from what is required with data obtained from the clipboard using <I>GetClipboardData</I>.</P>
<P>Call <I>IDataObject::Release</I> to match the <I>AddRef</I> called in <I>OleGetClipboard</I>.</P>
<P>Cosmo implements these steps in <I>CCosmoDoc::Paste</I>:</P>
<P><BR></P>
<pre><code>BOOL CCosmoDoc::Paste(HWND hWndFrame)<BR>    {<BR>    LPDATAOBJECT    pIDataObject;<BR>    BOOL            fRet;<BR><BR>    if (FAILED(OleGetClipboard(&amp;pIDataObject)))<BR>        return FALSE;<BR><BR>    fRet=PasteFromData(pIDataObject);<BR>    pIDataObject-&gt;Release();<BR>    return fRet;<BR>    }<BR><BR><BR>BOOL CCosmoDoc::PasteFromData(LPDATAOBJECT pIDataObject)<BR>    {<BR>    FORMATETC       fe;<BR>    STGMEDIUM       stm;<BR>    BOOL            fRet;<BR><BR>    SETDefFormatEtc(fe, m_cf, TYMED_HGLOBAL);<BR>    fRet=SUCCEEDED(pIDataObject-&gt;GetData(&amp;fe, &amp;stm));<BR><BR>    if (fRet &amp;&amp; NULL!=stm.hGlobal)<BR>        {<BR>        m_pPL-&gt;DataSetMem(stm.hGlobal, FALSE, FALSE, TRUE);<BR>        ReleaseStgMedium(&amp;stm);<BR>        FDirtySet(TRUE);<BR>        }<BR><BR>    return fRet;<BR>    }</code></pre>
<P>As we did for Cosmo's <I>FQueryPaste</I>, <I>Paste</I> obtains the data object pointer from <I>OleGetClipboard</I> and passes it to <I>PasteFromData</I>. A function such as <I>PasteFromData </I>is reusable (like <I>FQueryPasteFromData</I>), and I encourage you to make such a function because it will become useful in later work.</P></font></body></HTML>
